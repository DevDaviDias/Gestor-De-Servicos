<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro â€” GestÃ£o de ServiÃ§os</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./src/css/style.css">
  <link rel="icon" href="/pwa-192x192.png">
  <style>
    :root {
      --ink: #0f1117;
      --ink-soft: #4a4e5a;
      --ink-muted: #9095a1;
      --surface: #f5f6f8;
      --card: #ffffff;
      --accent: #2563eb;
      --accent-glow: rgba(37,99,235,0.15);
      --accent-soft: #eff4ff;
      --success: #059669;
      --success-soft: #ecfdf5;
      --danger: #dc2626;
      --danger-soft: #fef2f2;
      --warn: #d97706;
      --border: #e8eaee;
      --radius-lg: 20px;
      --radius-md: 14px;
      --radius-sm: 10px;
      --nav: 68px;
      --header: 60px;
      --shadow-card: 0 2px 16px rgba(15,17,23,0.08);
      --shadow-btn: 0 4px 14px rgba(37,99,235,0.35);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { -webkit-text-size-adjust: 100%; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BASE â€” igual em todos os tamanhos
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--surface);
      color: var(--ink);
      min-height: 100vh;
      padding-top: var(--header);
      padding-bottom: calc(var(--nav) + 20px);
    }

    /* â”€â”€ Header â”€â”€ */
    .top-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header);
      background: var(--card);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 16px;
      z-index: 99;
    }
    .app-name {
      font-size: 1.05rem;
      font-weight: 800;
      color: var(--ink);
      letter-spacing: -0.3px;
    }

    /* â”€â”€ Page content â”€â”€ */
    .page-content {
      max-width: 520px;
      margin: 0 auto;
      padding: 24px 16px 0;
    }

    /* No PC, apenas aumenta um pouco a largura mÃ¡xima */
    @media (min-width: 768px) {
      .page-content {
        max-width: 680px;
      }
    }

    /* â”€â”€ Step header â”€â”€ */
    .step-header { margin-bottom: 24px; }
    .step-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .step-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--border);
      transition: all 0.3s;
    }
    .step-dot.active {
      background: var(--accent);
      width: 24px;
      border-radius: 4px;
    }
    .step-dot.done { background: var(--success); }
    .step-label {
      font-family: 'Syne', sans-serif;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--accent);
      margin-bottom: 4px;
    }
    .step-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--ink);
      letter-spacing: -0.5px;
    }

    /* â”€â”€ Steps â€” mobile: 1 por vez / desktop: todos visÃ­veis â”€â”€ */
    .step { display: none; animation: fadeSlide 0.3s ease; }
    .step.active { display: block; }
    @keyframes fadeSlide {
      from { opacity: 0; transform: translateX(16px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    /* â”€â”€ No desktop mostra todos os steps de uma vez â”€â”€ */
    @media (min-width: 768px) {
      .step { display: block !important; animation: none; }
      .step + .step { margin-top: 20px; }
      .step-label { display: none; }
    }

    /* â”€â”€ Cards â”€â”€ */
    .form-card {
      background: var(--card);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: var(--shadow-card);
      display: flex;
      flex-direction: column;
      gap: 16px;
      border: 1px solid var(--border);
    }

    /* â”€â”€ Form groups â”€â”€ */
    .form-group { display: flex; flex-direction: column; gap: 7px; }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (min-width: 768px) {
      .form-row { grid-template-columns: 1fr 1fr 1fr; }
    }
    label {
      font-size: 0.78rem;
      font-weight: 500;
      color: var(--ink-soft);
      letter-spacing: 0.1px;
    }
    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1.5px solid var(--border);
      border-radius: var(--radius-sm);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.95rem;
      color: var(--ink);
      background: var(--surface);
      transition: all 0.2s;
      -webkit-appearance: none;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--card);
      box-shadow: 0 0 0 4px var(--accent-glow);
    }
    textarea { resize: none; min-height: 90px; line-height: 1.5; }

    /* â”€â”€ Photo upload â”€â”€ */
    .photo-upload-area {
      border: 2px dashed var(--border);
      border-radius: var(--radius-md);
      padding: 28px 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    .photo-upload-area:hover {
      border-color: var(--accent);
      background: var(--accent-soft);
    }
    .photo-upload-area input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      width: 100%; height: 100%;
    }
    .photo-icon { font-size: 2.2rem; margin-bottom: 8px; }
    .photo-text { font-size: 0.88rem; color: var(--ink-soft); line-height: 1.4; }
    .photo-text strong { color: var(--accent); }
    .photo-preview {
      border-radius: var(--radius-md);
      overflow: hidden;
      margin-top: 12px;
      display: none;
    }
    .photo-preview.has-photo { display: block; }
    .photo-preview img { width: 100%; height: 200px; object-fit: cover; }

    /* â”€â”€ Parts â”€â”€ */
    .parts-list { display: flex; flex-direction: column; gap: 10px; }
    .part-item {
      display: grid;
      grid-template-columns: 1fr 100px 36px;
      gap: 8px;
      align-items: center;
      background: var(--surface);
      padding: 10px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
    }
    .part-item input { background: var(--card); padding: 9px 12px; font-size: 0.88rem; }
    .btn-remove-part {
      width: 36px; height: 36px;
      border-radius: 8px;
      background: var(--danger-soft);
      color: var(--danger);
      border: none;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.2s;
    }
    .btn-remove-part:hover { background: #fecaca; }
    .btn-add-part {
      width: 100%;
      padding: 11px;
      border: 1.5px dashed var(--accent);
      border-radius: var(--radius-sm);
      background: none;
      color: var(--accent);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.88rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 4px;
    }
    .btn-add-part:hover { background: var(--accent-soft); }

    /* â”€â”€ Payment toggle â”€â”€ */
    .payment-toggle {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .toggle-option { position: relative; }
    .toggle-option input[type="radio"] {
      position: absolute; opacity: 0; width: 0; height: 0;
    }
    .toggle-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 12px;
      border-radius: var(--radius-sm);
      border: 2px solid var(--border);
      background: var(--surface);
      font-size: 0.88rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--ink-soft);
    }
    .toggle-option input:checked + .toggle-label {
      border-color: var(--success);
      background: var(--success-soft);
      color: var(--success);
    }
    .toggle-option input:checked + .toggle-label.pending-label {
      border-color: var(--warn);
      background: #fffbeb;
      color: var(--warn);
    }

    /* â”€â”€ Summary card â”€â”€ */
    .summary-card {
      background: var(--ink);
      border-radius: var(--radius-lg);
      padding: 20px;
      color: white;
    }
    .summary-title {
      font-family: 'Syne', sans-serif;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      opacity: 0.5;
      margin-bottom: 16px;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      font-size: 0.9rem;
    }
    .summary-row:last-child { border-bottom: none; }
    .summary-row span:first-child { opacity: 0.6; }
    .summary-row span:last-child { font-weight: 500; }

    /* â”€â”€ Buttons â”€â”€ */
    .btn-primary {
      width: 100%;
      padding: 15px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-family: 'Syne', sans-serif;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--shadow-btn);
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      letter-spacing: 0.2px;
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(37,99,235,0.4); }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .btn-secondary {
      width: 100%;
      padding: 14px;
      background: var(--surface);
      color: var(--ink-soft);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-md);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-secondary:hover { background: var(--border); }
    .btn-row {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 10px;
      margin-top: 4px;
    }

    /* No desktop, esconde os botÃµes Voltar/PrÃ³ximo dos steps 1 e 2,
       mas mantÃ©m o botÃ£o Salvar no step 3 */
    @media (min-width: 768px) {
      #step1 .btn-row,
      #step2 .btn-row { display: none; }

      #step3 .btn-row {
        grid-template-columns: 1fr;
      }
      #step3 .btn-secondary { display: none; }
    }

    /* â”€â”€ Alerts â”€â”€ */
    .alert {
      padding: 14px 16px;
      border-radius: var(--radius-md);
      font-size: 0.88rem;
      font-weight: 500;
      display: none;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    .alert.show { display: flex; }
    .alert-success { background: var(--success-soft); color: var(--success); }
    .alert-error   { background: var(--danger-soft);  color: var(--danger); }

    /* â”€â”€ Bottom nav â€” sempre fixo embaixo â”€â”€ */
    .bottom-nav {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      top: auto;
      width: 100%;
      height: var(--nav);
      background: var(--card);
      border-top: 1px solid var(--border);
      border-right: none;
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      align-items: stretch;
      z-index: 100;
      padding-top: 0;
    }
    .bottom-nav::before { display: none; }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      color: var(--ink-muted);
      text-decoration: none;
      transition: color 0.2s;
      padding: 8px 0;
      background: transparent;
      border-radius: 0;
      margin: 0;
    }
    .nav-item:hover { color: var(--accent); background: transparent; }
    .nav-item.active { color: var(--accent); background: transparent; }
    .nav-icon { font-size: 1.25rem; }
    .nav-label {
      font-size: 0.62rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: inherit;
    }

    /* â”€â”€ Spinner â”€â”€ */
    .spinner-sm {
      width: 18px; height: 18px;
      border: 2px solid rgba(255,255,255,0.35);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      display: none;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <!-- Top bar -->
  <header class="top-bar">
    <span class="app-name">ğŸ”§ GestÃ£o de ServiÃ§os</span>
  </header>

  <main class="page-content">
    <div id="successMessage" class="alert alert-success">
      âœ… Cliente cadastrado com sucesso!
    </div>
    <div id="errorMessage" class="alert alert-error">
      âŒ Erro ao cadastrar. Tente novamente.
    </div>

    <!-- Step indicator -->
    <div class="step-header">
      <div class="step-indicator">
        <div class="step-dot active" id="dot1"></div>
        <div class="step-dot" id="dot2"></div>
        <div class="step-dot" id="dot3"></div>
      </div>
      <div class="step-label" id="stepLabel">Passo 1 de 3</div>
      <div class="step-title" id="stepTitle">Cliente & ServiÃ§o</div>
    </div>

    <form id="clientForm">

      <!-- â”€â”€ STEP 1: Cliente & ServiÃ§o â”€â”€ -->
      <div class="step active" id="step1">
        <div class="form-card">
          <div class="form-group">
            <label for="clientName">Nome do Cliente</label>
            <input type="text" id="clientName" name="clientName" placeholder="Ex: JoÃ£o Silva" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="serviceDate">Data do ServiÃ§o</label>
              <input type="date" id="serviceDate" name="serviceDate" required>
            </div>
            <div class="form-group">
              <label for="warranty">Garantia (meses)</label>
              <input type="number" id="warranty" name="warranty" min="0" max="60" value="3" required>
            </div>
          </div>

          <div class="form-group">
            <label for="serviceValue">Valor Cobrado (R$)</label>
            <input type="number" id="serviceValue" name="serviceValue" step="0.01" min="0" placeholder="0,00" required>
          </div>

          <div class="form-group">
            <label>Pagamento</label>
            <div class="payment-toggle">
              <div class="toggle-option">
                <input type="radio" name="paymentStatus" id="pago" value="pago" checked>
                <label class="toggle-label" for="pago">âœ… Pago</label>
              </div>
              <div class="toggle-option">
                <input type="radio" name="paymentStatus" id="naopago" value="nao-pago">
                <label class="toggle-label pending-label" for="naopago">â³ Pendente</label>
              </div>
            </div>
          </div>

          <div class="btn-row">
            <div></div>
            <button type="button" class="btn-primary" onclick="goToStep(2)">PrÃ³ximo â†’</button>
          </div>
        </div>
      </div>

      <!-- â”€â”€ STEP 2: PeÃ§as & ObservaÃ§Ãµes â”€â”€ -->
      <div class="step" id="step2">
        <div class="form-card">
          <div class="form-group">
            <label>PeÃ§as Utilizadas</label>
            <div class="parts-list" id="partsContainer">
              <div class="part-item">
                <input type="text" placeholder="Nome da peÃ§a" class="part-name">
                <input type="number" placeholder="R$ 0,00" class="part-cost" step="0.01" min="0">
                <button type="button" class="btn-remove-part" aria-label="Remover">âœ•</button>
              </div>
            </div>
            <button type="button" id="addPart" class="btn-add-part">+ Adicionar PeÃ§a</button>
          </div>

          <div class="form-group">
            <label for="observations">ObservaÃ§Ãµes</label>
            <textarea id="observations" name="observations" placeholder="Descreva o problema e o que foi feito..."></textarea>
          </div>

          <div class="btn-row">
            <button type="button" class="btn-secondary" onclick="goToStep(1)">â† Voltar</button>
            <button type="button" class="btn-primary"   onclick="goToStep(3)">PrÃ³ximo â†’</button>
          </div>
        </div>
      </div>

      <!-- â”€â”€ STEP 3: Foto & Confirmar â”€â”€ -->
      <div class="step" id="step3">
        <div class="form-card" style="gap:20px;">

          <div class="form-group">
            <label>Foto do ServiÃ§o</label>
            <div class="photo-upload-area" id="photoUploadArea">
              <input type="file" id="servicePhoto" accept="image/*" capture="environment">
              <div class="photo-icon">ğŸ“·</div>
              <div class="photo-text">
                <strong>Toque para tirar foto</strong><br>
                ou escolher da galeria
              </div>
            </div>
            <div class="photo-preview" id="photoPreview">
              <img id="photoImg" src="" alt="Preview">
            </div>
          </div>

          <!-- Resumo -->
          <div class="summary-card" id="summaryCard">
            <div class="summary-title">Resumo do ServiÃ§o</div>
            <div class="summary-row"><span>Cliente</span>   <span id="sumName">â€”</span></div>
            <div class="summary-row"><span>Data</span>      <span id="sumDate">â€”</span></div>
            <div class="summary-row"><span>Valor</span>     <span id="sumValue">â€”</span></div>
            <div class="summary-row"><span>Garantia</span>  <span id="sumWarranty">â€”</span></div>
            <div class="summary-row"><span>Pagamento</span> <span id="sumStatus">â€”</span></div>
          </div>

          <div class="btn-row">
            <button type="button" class="btn-secondary" onclick="goToStep(2)">â† Voltar</button>
            <button type="submit" id="submitBtn" class="btn-primary">
              <span id="submitText">ğŸ’¾ Salvar</span>
              <span class="spinner-sm" id="loadingSpinner"></span>
            </button>
          </div>
        </div>
      </div>

    </form>
  </main>

  <!-- Nav â€” sempre embaixo -->
  <nav class="bottom-nav">
    <a href="index.html" class="nav-item active">
      <span class="nav-icon">ğŸ“</span>
      <span class="nav-label">Cadastro</span>
    </a>
    <a href="clientes.html" class="nav-item">
      <span class="nav-icon">ğŸ‘¥</span>
      <span class="nav-label">Clientes</span>
    </a>
    <a href="relatorios.html" class="nav-item">
      <span class="nav-icon">ğŸ“Š</span>
      <span class="nav-label">RelatÃ³rios</span>
    </a>
    <a href="configuracoes.html" class="nav-item">
      <span class="nav-icon">âš™ï¸</span>
      <span class="nav-label">Config</span>
    </a>
  </nav>

  <script>
    const steps  = ['step1','step2','step3'];
    const dots   = ['dot1','dot2','dot3'];
    const labels = ['Cliente & ServiÃ§o','PeÃ§as & ObservaÃ§Ãµes','Foto & Confirmar'];

    function isDesktop() { return window.innerWidth >= 768; }

    function goToStep(n) {
      if (isDesktop()) return;

      if (n === 2) {
        const name  = document.getElementById('clientName').value.trim();
        const date  = document.getElementById('serviceDate').value;
        const value = document.getElementById('serviceValue').value;
        if (!name || !date || !value) {
          document.getElementById('clientName').focus();
          return;
        }
      }
      if (n === 3) updateSummary();

      steps.forEach((s, i) => {
        document.getElementById(s).classList.toggle('active', i === n - 1);
        const dot = document.getElementById(dots[i]);
        dot.classList.remove('active','done');
        if (i === n - 1)  dot.classList.add('active');
        else if (i < n-1) dot.classList.add('done');
      });

      document.getElementById('stepLabel').textContent = `Passo ${n} de 3`;
      document.getElementById('stepTitle').textContent  = labels[n - 1];
      window.scrollTo(0, 0);
    }

    function updateSummary() {
      const fmt     = v => new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v);
      const fmtDate = d => new Date(d+'T12:00:00').toLocaleDateString('pt-BR');
      document.getElementById('sumName').textContent     = document.getElementById('clientName').value || 'â€”';
      document.getElementById('sumDate').textContent     = fmtDate(document.getElementById('serviceDate').value);
      document.getElementById('sumValue').textContent    = fmt(document.getElementById('serviceValue').value || 0);
      const w = document.getElementById('warranty').value;
      document.getElementById('sumWarranty').textContent = `${w} ${w == 1 ? 'mÃªs' : 'meses'}`;
      const paid = document.querySelector('input[name="paymentStatus"]:checked').value === 'pago';
      document.getElementById('sumStatus').textContent   = paid ? 'âœ… Pago' : 'â³ Pendente';
    }

    // No desktop atualiza o resumo em tempo real
    ['clientName','serviceDate','serviceValue','warranty'].forEach(id => {
      document.getElementById(id).addEventListener('input', () => { if (isDesktop()) updateSummary(); });
    });
    document.querySelectorAll('input[name="paymentStatus"]').forEach(el => {
      el.addEventListener('change', () => { if (isDesktop()) updateSummary(); });
    });

    // Photo Preview
    document.getElementById('servicePhoto').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        document.getElementById('photoImg').src = ev.target.result;
        document.getElementById('photoPreview').classList.add('has-photo');
        document.getElementById('photoUploadArea').style.display = 'none';
      };
      reader.readAsDataURL(file);
    });

    // Add Part
    document.getElementById('addPart').addEventListener('click', () => {
      const item = document.createElement('div');
      item.className = 'part-item';
      item.innerHTML = `
        <input type="text"   placeholder="Nome da peÃ§a" class="part-name">
        <input type="number" placeholder="R$ 0,00" class="part-cost" step="0.01" min="0">
        <button type="button" class="btn-remove-part" aria-label="Remover">âœ•</button>
      `;
      item.querySelector('.btn-remove-part').addEventListener('click', () => item.remove());
      document.getElementById('partsContainer').appendChild(item);
    });

    document.getElementById('partsContainer').addEventListener('click', e => {
      if (e.target.classList.contains('btn-remove-part'))
        e.target.closest('.part-item').remove();
    });

    window.setLoading = show => {
      document.getElementById('submitBtn').disabled           = show;
      document.getElementById('submitText').style.display     = show ? 'none' : 'inline';
      document.getElementById('loadingSpinner').style.display = show ? 'inline-block' : 'none';
    };

    window.showAlert = id => {
      const el = document.getElementById(id);
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 3500);
    };
  </script>

  <script type="module" src="./src/js/main.js"></script>
</body>
</html>